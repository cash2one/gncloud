version: '2'
services:
  web:
    image: web-front
    restart: always
    volumes:
      - /etc/nginx:/etc/nginx
      - /var/log/nginx:/var/log/nginx
    ports:
      - "80:80"
      - "443:443"
    depends_on:
      - db
      - manager
      - kvm
      - docker
      - hyperv
      - scheduler
    networks:
      - front
      - back

  db:
    image: mysql
    restart: always
    ports:
      - "3306:3306"
    environment:
      MYSQL_ROOT_PASSWORD: gncloud
      MYSQL_DATABASE: gncloud
      MYSQL_USER: gncloud
      MYSQL_PASSWORD: gncloud
    networks:
      - front
      - back

  manager:
    image: manager-controller
    volumes:
      - /var/log/gncloud:/var/log/gncloud
      - /root/.ssh:/root/.ssh
    ports:
      - "8080:80"
    restart: always
    environment:
      WSGI_PROCESSES: 4
      WSGI_THREADS: 2
      IP: 192.168.1.101
      PORT: 3306
      USER: gncloud
      PASS: gncloud
      DBNAME: gncloud
    depends_on:
      - db
    networks:
      - back

  kvm:
    image: kvm-controller
    volumes:
      - /var/log/gncloud:/var/log/gncloud
      - /root/.ssh:/root/.ssh
    ports:
      - "8081:80"
    restart: always
    environment:
      WSGI_PROCESSES: 4
      WSGI_THREADS: 2
      IP: 192.168.1.101
      PORT: 3306
      USER: gncloud
      PASS: gncloud
      DBNAME: gncloud
    depends_on:
      - db
    networks:
      - back

  hyperv:
    image: hyperv-controller
    volumes:
      - /var/log/gncloud:/var/log/gncloud
      - /root/.ssh:/root/.ssh
    ports:
      - "8082:80"
    restart: always
    environment:
      WSGI_PROCESSES: 4
      WSGI_THREADS: 2
      IP: 192.168.1.101
      PORT: 3306
      USER: gncloud
      PASS: gncloud
      DBNAME: gncloud
    depends_on:
      - db
    networks:
      - back

  docker:
    image: docker-controller
    volumes:
      - /var/log/gncloud:/var/log/gncloud
      - /root/.ssh:/root/.ssh
    ports:
      - "8083:80"
    restart: always
    environment:
      WSGI_PROCESSES: 4
      WSGI_THREADS: 2
      IP: 192.168.1.101
      PORT: 3306
      USER: gncloud
      PASS: gncloud
      DBNAME: gncloud
    depends_on:
      - db
    networks:
      - back

  scheduler:
    image: scheduler
    volumes:
      - /var/log/gncloud:/var/log/gncloud
      - /root/.ssh:/root/.ssh
    ports:
      - "8084:80"
    restart: always
    environment:
      WSGI_PROCESSES: 4
      WSGI_THREADS: 2
      IP: 192.168.1.101
      PORT: 3306
      USER: gncloud
      PASS: gncloud
      DBNAME: gncloud
    depends_on:
      - db
    networks:
      - back

networks:
  front:
    driver: brigde
  back:
    driver: host

       # ssh-keygen -f ~/.ssh/id_rsa
       # ssh-copy-id -i ~/.ssh/id_rsa.pub root@192.168.1.2
       # ssh-copy-id -i ~/.ssh/id_rsa.pub root@192.168.1.201
       # ssh-copy-id -i ~/.ssh/id_rsa.pub root@192.168.1.202
       # ssh-copy-id -i ~/.ssh/id_rsa.pub root@192.168.1.203
       # ssh-copy-id -i ~/.ssh/id_rsa.pub root@192.168.1.204
       # docker run -d --name web-front -p 80:80 -v /var/log/nginx:/var/log/nginx -v /etc/nginx:/etc/nginx web-front
       # docker run -d --name manager-controller -p 8080:80 -v /var/log/gncloud:/var/log/gncloud -v /root/.ssh:/root/.ssh manager-controller
       # docker run -d --name kvm-controller -p 8081:80 -v /var/log/gncloud:/var/log/gncloud -v /root/.ssh:/root/.ssh kvm-controller
       # docker run -d --name hyperv-controller -p 8082:80 -v /var/log/gncloud:/var/log/gncloud -v /root/.ssh:/root/.ssh hyperv-controller
       # docker run -d --name docker-controller -p 8083:80 -v /var/log/gncloud:/var/log/gncloud -v /root/.ssh:/root/.ssh docker-controller
       # docker run -d --name scheduler -p 8084:80 -v /var/log/gncloud:/var/log/gncloud -v /root/.ssh:/root/.ssh scheduler
